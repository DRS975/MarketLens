<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AR Navigation - Active</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* HUD Specific Styles to ensure layout safety */
        .nav-hud-top {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            z-index: 10;
        }
        .hud-box {
            background: rgba(0, 20, 30, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--ar-cyan);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            min-width: 130px;
        }
        .hud-label { font-size: 0.7rem; color: var(--ar-cyan); letter-spacing: 2px; display: block; }
        .hud-value { font-size: 1.6rem; color: white; font-weight: bold; }
        
        /* Ensure the background covers full screen */
        body {
            margin: 0;
            height: 100vh;
            background-color: black;
            background-position: center;
            background-size: cover;
            transition: background-image 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="ar-overlay">
        <div class="nav-hud-top">
            <div class="hud-box">
                <span class="hud-label">DISTANCE</span>
                <span class="hud-value" id="dist">--m</span>
            </div>
            <div class="hud-box">
                <span class="hud-label">ETA</span>
                <span class="hud-value" id="eta">--:--</span>
            </div>
        </div>

        <div class="path-container" id="path-ui">
            <div class="ar-arrow">
                <div class="arrow-head"></div>
                <div class="arrow-line"></div>
            </div>
            <div class="destination-marker">
                <div class="pulse-ring"></div>
                <span class="dest-label" id="target-label"></span>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="menu-item nav-btn" onclick="window.history.back()">❮</button>
            <a href="index.html" class="menu-item nav-btn">⌂</a>
            <button class="menu-item" onclick="window.location.href='index.html'" style="width: 180px;">END SESSION</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        window.onload = function() {
            // 1. GET DATA FROM URL
            const urlParams = new URLSearchParams(window.location.search);
            const bg = urlParams.get('bg');
            
            const distElement = document.getElementById('dist');
            const etaElement = document.getElementById('eta');
            const pathUI = document.getElementById('path-ui');
            const label = document.getElementById('target-label');

            // 2. SET BACKGROUND
            if (bg) {
                document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.3)), url('${bg}')`;
                console.log("Navigation Loaded: " + bg);
            }

            // 3. LOGIC SWITCH: MENU vs. NAVIGATION
            if (bg && bg.toLowerCase().includes('menu')) {
                // ARRIVAL MODE (For Food, Wine, Cocoa)
                distElement.innerText = "0m";
                etaElement.innerText = "ARRIVED";
                label.innerText = "STALL_REACHED";
                pathUI.style.display = "none"; // Hide arrows because we are there
            } else {
                // WALKING MODE (For Bob, Alice, Tree, Band)
                startWalkingLogic(bg, distElement, etaElement);
            }
        };

        function startWalkingLogic(filename, distEl, etaEl) {
            let distance = 120; // Default start
            
            // Adjust starting distance based on target
            if (filename.includes('Bob')) distance = 45;
            if (filename.includes('Band')) distance = 80;

            const updateTimer = setInterval(() => {
                if (distance > 0) {
                    distance -= 1;
                    distEl.innerText = distance + "m";
                    
                    // Rough ETA calculation
                    let totalSeconds = Math.floor(distance * 1.5);
                    let m = Math.floor(totalSeconds / 60);
                    let s = totalSeconds % 60;
                    etaEl.innerText = `${m}:${s < 10 ? '0' : ''}${s} min`;
                } else {
                    distEl.innerText = "ARRIVED";
                    clearInterval(updateTimer);
                }
            }, 1000);
        }
    </script>
</body>
</html>